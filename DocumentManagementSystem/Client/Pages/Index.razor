@page "/"
@page "/index"
@page "/home"
@using DocumentManagementSystem.Shared
@using DocumentManagementSystem.Client.Components.OpenAPI
@using DocumentManagementSystem.Shared.Responses
@inject NavigationManager _navigation
@inject IHttpClientFactory _httpClientFactory

<PageTitle>Все проекты</PageTitle>

<div class="wrapper menu">
    @if (documents is null)
    {
        <p><em>загрузка...</em></p>
    }
    else
    {
        @foreach (var document in documents)
        {
            <NavLink class="nav-link">
                <div class="menuItem" @onclick="()=>NavigateToViewing(document.Code)">
                    <div>
                        <span>@document.Name</span>
                        <p>@document.Description</p>
                    </div>
                    <small />
                    <button class="expand-operation">
                        <UISVGRotate Rotate="-90" />
                    </button>
                </div>
            </NavLink>
        }
    }
</div>

@code {
    private void NavigateToViewing(string code)
    {
        _navigation.NavigateTo($"/viewing/{code}");
    }

    List<ShortDescriptionResponse>? documents;
    HttpClient client;

    protected override async Task OnInitializedAsync()
    {
        client = _httpClientFactory.CreateClient("Api");

        var doc = await client.GetFromJsonAsync<List<ShortDescriptionResponse>>($"/ShortDescription");

        documents = doc;
    }
}
